import{u as V,a as J,b as _,r,j as f,c as F,d as t,E as pe,F as me,B as U,e as he,s as fe,f as ye,g as Y,h as ge,i as ee,T as ve,P as be,S as xe,O as Te}from"./index-BNDtW2eT.js";import{N as q,L as O}from"./index-Ck5G4mD3.js";import{l as Ne}from"./logo2-DYc4F8xQ.js";import{B as j,I as we,a as Se,A as te,S as Ie,b as ie,c as Pe,d as oe,u as le,e as ke,N as re}from"./index-C6DPW6pI.js";import{D as R,I as Ce}from"./index-B-XWCHoo.js";import{V as a,B as Z,u as H,l as Me,F as ce,s as Ee}from"./formPage-BHPYqPSB.js";import{L as $e}from"./LinkMe-BinTiMd6.js";import{l as Ae,e as De,r as Fe,c as ze}from"./SysApp-rYatu4bx.js";import{s as W,a as se,r as Ke}from"./SysMenu-CgEQZZD1.js";import{G as Le}from"./GroupButton-D5eFJVxs.js";import{v as Re}from"./vlifeModal-DhFQGOhg.js";import"./index-DQz7rEVH.js";const Ue=[a.then("app").value(!0).hide(),a.then("url","formId","pcode","pageType","pageLayoutId","formType","entityType").hide().clearValue(),a.field("id").isNotNull().then("appKey").readPretty(),a.then("icon").required(),a.then("appKey").required(),a.field("appKey").regex(/^[a-z]+$/).then("appKey").feedback("需小写字母(作为类的包名)"),a.then("appKey").description(s=>s.appKey&&`服务端代码将创建在cn.vlife.${s.appKey}包下`),a.then("name").title("应用名称")];a.then("app","appKey","code","pcode","url","sort","pageType","pageLayoutId","formType","entityType","formId").hide(),a.then("name").title("分组名称");const Oe=[a.then("app","appKey","code","pcode","url","sort","pageType","pageLayoutId").hide(),a.field("id").isNotNull().then("entityType","formType").readPretty(),a.then("name").title("菜单名称"),a.field("entityType").isNotNull().then("formType").show(),a.then("entityType").required(),a.field("entityType").change().then("formType").clearValue(),a.then("icon").title("菜单图标"),a.then("url").value("/table/*"),a.then("pageType").value("crudPage")],Be=[a.then("app","appKey","code","pcode","url","sort","pageType","formType","entityType","formId","pageLayoutId").hide(),a.then("name").title("菜单名称"),a.then("icon").title("菜单图标"),a.then("formId").hide().clearValue(),a.then("url").value("/chart/*"),a.then("pageType").value("chartPage")],je=[a.then("app","appKey","code","pcode","sort","formId","pageType","formType","entityType","pageLayoutId").hide(),a.then("pageType").value("customPage"),a.then("name").title("菜单名称"),a.then("icon").title("菜单图标")],He=(s,i)=>{const m=s.filter(o=>o.sysAppId===i),u=m.filter(o=>!o.pcode).sort((o,x)=>o.sort-x.sort),p=o=>{if(o.url)return o.url.endsWith("*")?o.url.substring(0,o.url.length-1)+o.id:o.url};for(const o of u){const x=p(o);if(x)return{...o,url:x};const N=m.filter(h=>h.pcode===o.code).sort((h,$)=>h.sort-$.sort).find(h=>h.url);if(N){const h=p(N);if(h)return{...N,url:h}}}},Ge={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_API_URL:"",VITE_APP_MODE:"pro",VITE_APP_PAGESIZE:"15",VITE_APP_SAVE_REMOVE:"true",VITE_APP_TITLE:"vlife快速研发平台",VITE_APP_VERSION:"free"},We="",{Header:qe}=O,{VITE_APP_API_URL:Ve}=Ge,ne="free";function de(s){return s?typeof s=="string"?t("div",{className:"h-full flex items-center",children:t(Ie,{readPretty:!0,value:s})}):s.render():null}const Je=()=>{const{loginOut:s,user:i,setApp:m,app:u,menu:p,setMenu:o,datasInit:x,sysVar:N}=V(),h=J(),$=_(),{pathname:c}=$,[y,w]=r.useState(),P=r.useCallback(()=>{Ae().then(v=>{var C;const l=[...new Set(i==null?void 0:i.menus.map(M=>M.sysAppId))],d=(C=v.data)==null?void 0:C.filter(M=>(i==null?void 0:i.superUser)||l.includes(M.id)).sort((M,A)=>M.sort-A.sort);w(d)})},[i==null?void 0:i.menus.map(v=>v.sysAppId).join("")]);r.useEffect(()=>{P()},[i==null?void 0:i.menus.map(v=>v.sysAppId).join("")]),r.useEffect(()=>{var v,l;if(!p&&!u&&y&&y.length>0){if(c==="/"||c==="")m(y[0]);else if(c){let d=(l=(v=i==null?void 0:i.menus)==null?void 0:v.filter(C=>C.url===c||c.endsWith(C.id)))==null?void 0:l[0];d!==void 0?(m(y==null?void 0:y.find(C=>C.id===(d==null?void 0:d.sysAppId))),o(d)):m(y[0])}}},[c,y]);const S=r.useMemo(()=>(y==null?void 0:y.map(l=>({itemKey:l.id,icon:de(l.icon),onClick:()=>{l.id!==(u==null?void 0:u.id)&&m(l)},text:f("div",{className:`${F({" text-blue-500 ":(u==null?void 0:u.id)===l.id})} z-10 flex !items-center relative  hover:text-blue-500 `,children:[t("span",{children:l.name}),(i==null?void 0:i.superUser)&&t("div",{className:"!z-20",onClick:d=>{d.cancelable=!0,d.stopPropagation()},children:t(Z,{dropdown:!0,onDataChange:()=>{x("menu")},btns:[{title:"编辑应用",saveApi:De,model:"sysApp",actionType:"edit",reaction:Ue,submitClose:!0,datas:l,onSubmitFinish:()=>{P()}},{title:"删除应用",saveApi:Fe,actionType:"api",multiple:!0,datas:l,usableMatch:d=>(i==null?void 0:i.menus.filter(C=>{var M;return C.sysAppId===((M=d==null?void 0:d[0])==null?void 0:M.id)}).length)>0?"应用下有模块不能删除":!0,onSubmitFinish:()=>{P()}}]},`app_${l.id}`)})]},`app_${l.id}`)})))||[],[y,c,u]);return r.useEffect(()=>{console.log("-------------------------------"),console.log(`------vlife2.0.1(${ne})------`),console.log("-------------------------------")},[ne]),t(qe,{className:"layout-header shadow",children:t(q,{mode:"horizontal",header:t("div",{className:" flex !items-center cursor-pointer ",onClick:()=>{h("/dashboard")},style:{width:160,height:30,top:10},children:N!=null&&N.icon?t("img",{src:We+"/sysFile/image/"+N.icon,style:{width:160,height:40,top:10}}):t(pe,{className:" relative top-3  mr-4",image:t("img",{src:Ne,style:{width:160,height:40,top:10}})})}),selectedKeys:[(u==null?void 0:u.id)||""],items:S,footer:f(me,{children:[(i==null?void 0:i.superUser)&&f("div",{className:"flex",children:[t(j,{theme:"solid",className:" h-full items-center   ",title:"创建应用",tooltip:"新增一个平台应用",icon:t("i",{className:"  icon-task_add-02"}),actionType:"create",model:"sysApp",allowEmpty:!0,submitClose:!0,saveApi:ze,reaction:[a.then("appKey").description(v=>v.appKey&&`服务端代码将创建在cn.vlife.${v.appKey}包下`),a.then("sort").value(((y==null?void 0:y.length)||0)+1)],onSubmitFinish:(...v)=>{m(v[0]),w(l=>[...l||[],v[0]]),x("menu"),h(`/design/modelDesign?appId=${v[0].id}&modelId=undefined`)}},`createApp_${c}`),t(U,{theme:"borderless",onClick:()=>{h(`/design/modelDesign${u&&`?appId=${u.id}`}`)},style:{color:"var(--semi-color-text-2)"},icon:t("i",{className:"icon-settings text-xl text-indigo-500"}),children:"模型管理"}),t(U,{theme:"borderless",className:"2xl:!block !hidden",style:{color:"var(--semi-color-text-2)"},onClick:()=>{h("/vlife/common/iconContainer")},icon:t("i",{className:"icon-descending-order2 text-xl"}),children:"图标库"}),t($e,{}),t(U,{theme:"borderless",className:"2xl:!block !hidden",icon:t(we,{size:"large"}),style:{color:"var(--semi-color-text-2)",marginRight:"12px"},onClick:()=>{window.open("http://vlife.cc")},children:"官网"}),t(U,{theme:"borderless",className:"2xl:!block !hidden",icon:t(Se,{size:"large"}),style:{color:"var(--semi-color-text-2)",marginRight:"12px"},onClick:()=>{window.open("https://gitee.com/wwwlike/vlife")},children:"GITEE"})]}),t("div",{className:" m-2 !text-sm !text-blue-300 font-medium cursor-pointer",onClick:()=>{window.open("http://vlife.cc")},children:"vlife基础版"}),t(R,{position:"bottomLeft",render:f(R.Menu,{children:[f(R.Item,{onClick:s,children:[t("i",{className:"  icon-exit_to_app mr-2"}),t("span",{children:"退出登录"})]}),f(R.Item,{children:[t("i",{className:"  icon-limit-othermember mr-2"}),t(j,{btnType:"link",loadApi:he,model:"sysUserDto",actionType:"edit",reaction:[a.then("name","username","sysDeptId","sysUserGroup_sysGroupId").readPretty(),a.then("superUser","state").hide()],datas:{id:i==null?void 0:i.id},allowEmpty:!0,saveApi:fe,title:"基本信息"})]}),f(R.Item,{children:[t("i",{className:"  icon-password mr-2"}),t(j,{btnType:"link",datas:{id:i==null?void 0:i.id},model:"userPasswordModifyDto",actionType:"edit",submitClose:!0,saveApi:ye,onSubmitFinish:v=>{s()},title:"密码修改"})]})]}),children:i!=null&&i.avatar?t(te,{alt:"beautiful cat",size:"small",src:`${Ve}/sysFile/image/${i==null?void 0:i.avatar}`,style:{margin:4}}):t(te,{color:"orange",size:"small",children:i==null?void 0:i.name[0]})})]})})})},_e=[{label:"表单页面",desc:"用于填写、查询数据",icon:t("i",{className:"icon-rename_input text-4xl"}),key:"crudPage"},{label:"分析页面",desc:"用于分析、可视化展现数据",icon:t("i",{className:" icon-stats_funnel_chart text-4xl"}),key:"chartPage"},{label:"二开页面",desc:"自行开发的页面功能接入",icon:t("i",{className:" icon-workflow_write text-4xl"}),key:"customPage"}],ae=({onChange:s,onForm:i,pcode:m,appId:u})=>{const[p,o]=Y.useState("crudPage"),{model:x}=H({type:"sysMenu"}),{model:N}=H({type:"menuCrudDto"}),[h,$]=Y.useState();r.useEffect(()=>{s&&h&&s(h)},[h]);const[c,y]=r.useState(0);return r.useEffect(()=>{Me({req:{appId:u,itemType:"entity"}}).then(w=>{var P;y(((P=w.data)==null?void 0:P.filter(S=>S.state!=="creating").length)||0)})},[]),r.useMemo(()=>p==="crudPage"?[...Oe,a.then("pcode").value(m),a.result(c===0).then("entityType").feedback("当前没有任何发布的实体")]:p==="chartPage"?[...Be,a.then("pcode").value(m)]:p==="customPage"?[...je,a.then("pcode").value(m)]:[],[p,m]),f("div",{className:"w-full h-full space-x-4 flex-col",children:[t("div",{className:"w-full flex h-24 space-x-4",children:_e.map((w,P)=>f("div",{onClick:()=>o(w.key),className:`${F({"border-blue-500 bg-blue-50 hover:bg-blue-50":p===w.key,"border-gray-300":p!==w.key})} relative block w-1/3 cursor-pointer  border-2 border-dashed rounded-lg  text-center hover:border-blue-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500`,children:[w.icon,t("span",{className:"mt-1 block text-sm font-bold text-gray-900",children:w.label}),t("span",{className:"mt-1 block text-sm font-medium text-gray-500",children:w.desc})]},P))}),f("div",{className:" flex flex-1  p-4",children:[x&&p==="crudPage"&&t(ce,{fieldOutApiParams:{formId:{conditions:ge({appId:u})}},formData:{sysAppId:u,pageType:p,pcode:m},terse:!0,formSetting:!0,onForm:i,reaction:[a.then("groupIds").value(void 0).hide()],className:"w-full",onChange:$,modelInfo:N},p),p==="chartPage"&&t("div",{className:"flex w-full  h-20 justify-center items-center text-blue-500  font-medium",children:"请升级到专业版以上"}),p==="customPage"&&t("div",{className:"flex w-full  h-20 justify-center items-center text-blue-500  font-medium",children:"开发人员通过自定义页面实现复杂功能，需要升级后使用"})]})]})},{Sider:Ze}=O,Qe=()=>{var z,E,B;const{user:s,app:i,setMenu:m,menu:u,datasInit:p}=V(),o=J(),{getModel:x}=H(),{pathname:N}=_(),[h,$]=r.useState([]),[c,y]=r.useState([]),[w,P]=r.useState(window.innerHeight),[S,v]=r.useState({}),l=20,d=r.useMemo(()=>{var I,k;const n=((I=s==null?void 0:s.menus.filter(e=>!!e.url))==null?void 0:I.slice(0,l).map(e=>e.id))||[];return s!=null&&s.menus&&i?(k=s.menus)==null?void 0:k.filter(e=>(e==null?void 0:e.sysAppId)===i.id).filter(e=>!e.url||e.sys===!0||n.includes(e.id)):[]},[s==null?void 0:s.menus,i]);r.useEffect(()=>{d.filter(n=>n.pageType==="crudPage").forEach(n=>{x({id:n.formId}).then(I=>{v(k=>({...k,[n.formId]:I==null?void 0:I.state}))})})},[d]),r.useEffect(()=>{if(!u&&d&&i){const n=He(d,i.id);n&&(m(n),o(n==null?void 0:n.url))}},[u,d,i]);const C=r.useCallback(n=>{var I;if(n.selectedItems&&((I=n.selectedItems[0])!=null&&I.path)){const k=n.selectedItems[0].id,e=s==null?void 0:s.menus.find(g=>g.id===k);m(e),y([k]),o(n.selectedItems[0].path)}},[s==null?void 0:s.menus]),M=n=>{$([...n.openKeys])};r.useEffect(()=>{u&&(!c||c.length===0||!c.includes(u.id))&&y([u==null?void 0:u.id]),$(d.filter(n=>!n.url).map(n=>n.id))},[u,c,s==null?void 0:s.menus,d,i==null?void 0:i.id]);const A=r.useMemo(()=>{const n=(I,k)=>d.sort((e,g)=>e.sort-g.sort).filter(e=>e.pcode===(k?null:I==null?void 0:I.code)).map(e=>({id:e.id,itemKey:e.id,isLocked:!!e.pageType,text:s!=null&&s.superUser?f("div",{className:" group z-10 flex items-center relative w-28",children:[f("div",{className:"z-10 flex  w-full  items-center ",children:[t("div",{className:"flex items-center ",children:e.name}),e.pageType==="crudPage"&&S[e.formId]!=="published"&&t(ve,{content:"可以访问，正常使用需重启服务",children:t("i",{className:" icon-replay flex items-center absolute right-6  text-red-500"})})]}),f("div",{className:"flex absolute items-center right-0 !z-20 ",onClick:g=>{g.cancelable=!0,g.stopPropagation()},children:[t(Z,{dropdown:!0,datas:[e],className:F({"hidden group-hover:block":!c.includes(e.id)}),btns:[{title:(e==null?void 0:e.pageType)==="crudPage"?"编辑菜单":"菜单授权",icon:t(ie,{size:"small",className:"z-20"}),actionType:"edit",disabledHide:!0,reaction:[a.field("pageType").eq("chartPage").then("formId").hide(),a.field("pageType").ne("chartPage").then("groupIds").hide()],disabled:e.pageType!=="crudPage"&&e.pageType!=="chartPage",model:"menuCrudDto",saveApi:W,onSubmitFinish:(...g)=>{p("menu")}},{title:"模型设计",icon:t("i",{className:"  icon-shareLink"}),actionType:"click",disabledHide:!0,disabled:e.pageType!=="crudPage",onClick:()=>{o(`/design/modelDesign?appId=${i==null?void 0:i.id}&modelId=${e.formId}`)}},{title:"表单设计",icon:t("i",{className:"  icon-construction"}),actionType:"click",disabledHide:!0,disabled:e.pageType!=="crudPage",onClick:()=>{o(`/full/formDesign/${e.formId}`)}},{title:"编辑分组",icon:t(ie,{size:"small",className:"z-20"}),actionType:"edit",disabledHide:!0,disabled:!(!e.pcode&&!e.url&&e.pageType!=="crudPage"&&e.pageType!=="chartPage"),model:"menuGroupDto",saveApi:se,onSubmitFinish:(...g)=>{p("menu")}},{title:e.url?"删除菜单":"删除分组",actionType:"api",icon:t(Pe,{size:"small",className:"z-20"}),saveApi:(...g)=>Ke([e.id]),submitConfirm:!0,onSubmitFinish:(...g)=>{p("menu").then(()=>{m(void 0)})},usableMatch:()=>{var g;return e.sys===!0?"系统级菜单不允许删除":((g=s.menus)==null?void 0:g.filter(D=>D.pcode===e.code).length)>0?"分组下有菜单不能删除":!0}}]},e.id+JSON.stringify(c)),!e.pcode&&!e.url&&t(j,{title:"添加子菜单",btnType:"icon",icon:t("i",{className:"  icon-task_add-02"}),actionType:"modal",modal:t(ae,{pcode:e.code,appId:k==null?void 0:k.id}),saveApi:W,submitClose:!0,onSubmitFinish:g=>{p("btn"),p("menu").then(()=>{y([g.data.id]),g.data.pageType==="crudPage"?o(`/table/${g.data.id}`):g.data.pageType==="chartPage"?o(`/chart/${g.data.id}`):o(`${g.data.url}`)})}},e.id+N)]})]},e.id):t("div",{onClick:()=>{m(e)},children:e.name},e.id),code:e.code,icon:e.icon?de(e.icon):null,path:e.url&&e.url.endsWith("*")?e.url.substring(0,e.url.length-1)+e.id:e.url,items:n(e,null)}));return i&&d?n(null,i):[]},[d,i,c,s==null?void 0:s.menus,N,S]);return r.useEffect(()=>{const n=()=>{P(window.innerHeight)};return window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[]),t(Ze,{children:t(q,{toggleIconPosition:s!=null&&s.superUser?"left":"right",bodyStyle:{height:`${w-110}px`},className:"!overflow-y-auto relative  !z-10  ",items:A&&A.length>0?A:[],openKeys:h&&h.length>0?h:[(z=A==null?void 0:A[0])==null?void 0:z.id],selectedKeys:c,onSelect:C,onOpenChange:M,style:{maxWidth:220,height:"100%"},onCollapseChange:n=>{},children:t(q.Footer,{collapseButton:!0,className:" !absolute !bottom-0   items-center justify-between  flex  w-full",children:(i==null?void 0:i.id)&&(s==null?void 0:s.superUser)&&f("div",{className:` flex group items-center  ${F({"absolute bottom-96 ":d.length===0})}  w-full  h-full  justify-center`,children:[t(Le,{className:`${F({"flex flex-col space-y-2 items-center justify-center":d.length===0," grid-cols-2 grid gap-y-2":d.length!=0})}
                  `,btns:[{icon:t("i",{className:"icon-add_circle"}),title:"建模",theme:"solid",actionType:"create",model:"form",submitClose:!0,reaction:[a.then("sysAppId").value(i==null?void 0:i.id).readPretty(),a.then("itemType").value("entity")],onSaveBefore:n=>(n.type=ee(n.type),n.entityType=ee(n.type),n),disabledHide:!0,saveApi:Ee,onSubmitFinish:n=>{o(`/design/modelDesign?appId=${i==null?void 0:i.id}&modelId=${n.id}`)}},{title:"菜单",icon:t("i",{className:"  icon-task_add-02"}),actionType:"modal",modal:t(ae,{appId:i.id}),disabled:((E=s==null?void 0:s.menus)==null?void 0:E.filter(n=>!!n.url).length)>l,disabledTooltip:"已到达菜单数量上限,升级到标准版以上无限制",saveApi:W,submitClose:!0,onSubmitFinish:n=>{p("btn").then(()=>{p("menu").then(()=>{m(n.data),n.data.pageType==="crudPage"?o(`/table/${n.data.id}`):n.data.pageType==="chartPage"?o(`/chart/${n.data.id}`):o(`${n.data.url}`)})})}},{icon:t("i",{className:"icon-add_circle"}),title:"分组",model:"menuGroupDto",saveApi:se,actionType:"create",initData:{sysAppId:i.id},submitClose:!0,onSubmitFinish:()=>{p("menu")}},{title:"排序",disabledHide:!0,disabled:d.length<=1,allowEmpty:!0,icon:t("i",{className:" text-blue-500 icon-task-folder-slide-sort text-sm"}),actionType:"click",onClick:()=>{o("/vlife/sysMenu")}}]}),f("div",{className:" absolute -top-4 text-xs group-hover:block hidden text-red-400",children:["还可创",l-((B=s==null?void 0:s.menus)==null?void 0:B.filter(n=>!!n.url).length),"个菜单，升级后无限制"]})]},i==null?void 0:i.id)})})})},Xe=oe("formModal",({modelInfo:s,formData:i,width:m,activeKey:u,onError:p,formDesign:o=!1,btns:x,modifyData:N,...h})=>{var X;const $=le("formModal"),[c,y]=r.useState({width:window.screen.width,height:window.screen.height}),w=J(),{user:P}=V(),[S,v]=r.useState((X=x==null?void 0:x[0])==null?void 0:X.continueCreate),[l,d]=r.useState(i),[C,M]=r.useState(0),[A,z]=r.useState();r.useEffect(()=>{z(N)},[N]);const[E,B]=r.useState(),[n,I]=r.useState([]),{model:k}=H(s?{}:{type:h.type}),e=s||k,g=r.useMemo(()=>{var L;const b=(l==null?void 0:l.no)||"";if(h.title)return h.title;if(e===void 0)return`“${h.type}”模型标识不存在`;const T=(e==null?void 0:e.title)||e.type;return h.readPretty?T+"详情"+b:(L=E==null?void 0:E.values)!=null&&L.id?T+b:"新建("+T+")"},[l,E,e]),D=r.useMemo(()=>x&&E?x.map(b=>({...b,btnType:"button",position:"formFooter",datas:{...l},onSubmitFinish:T=>{S===!0||S===void 0&&b.continueCreate===!0?(d(void 0),M(L=>L+1)):(d(T),z(T)),b.onSubmitFinish&&b.onSubmitFinish(T)},onFormilySubmitCheck:()=>E.submit().then(T=>!0).catch(T=>!1)})):[],[x,E,e,l,S]),G=D.filter(b=>b.actionType==="create"&&b.continueCreate!==void 0),ue=r.useMemo(()=>D&&D.length>0?f("div",{className:"flex w-full justify-end relative h-full items-center  space-x-2",children:[o===!1&&(P==null?void 0:P.superUser)===!0&&f("div",{className:"flex flex-1    font-normal space-x-4  items-center justify-start ",children:[f("div",{onClick:()=>{w(`/full/formDesign/${e.type}`)},className:" cursor-pointer flex hover:text-blue-500 items-center space-x-1",children:[t(Ce,{size:"small"}),t("span",{children:"表单配置"})]}),l&&t(be,{content:f("pre",{className:"p-2",children:[" ",JSON.stringify(l,null,2)]}),children:f("div",{className:" cursor-pointer flex hover:text-blue-500 items-center space-x-1",children:[t("i",{className:"  icon-eye"})," ",t("span",{children:"JSON数据"})]})})]}),G.length>0&&f("div",{className:"absolute flex left-2 items-center",children:[t("span",{className:`text-gray-400 ${F({"!text-gray-800":S!==void 0?S:G[0].continueCreate})}`,children:"连续新增"}),t(ke,{checked:S!==void 0?S:G[0].continueCreate,onChange:b=>{v(b)},checkedText:"开",uncheckedText:"关"})]}),D.length>0?t(Z,{datas:[(l==null?void 0:l.flow)!==void 0?l:{...l}],btns:D.map(b=>({...b,modalOpen:!0})),entity:s==null?void 0:s.entityType,activeKey:u,dataType:s==null?void 0:s.type,position:"formFooter",btnType:"button"}):t(U,{onClick:()=>{$.hide()},children:"关闭"})]}):t("div",{}),[D,l,E,S]),K=r.useMemo(()=>c.width<=1280?1:c.width<=1600?.9:c.width<=1920?.8:c.width<=2560?.65:c.width<=3840?.55:c.width<=5120?.45:.4,[c]),Q=r.useMemo(()=>{if(m)return m;let T=0;return(e==null?void 0:e.modelSize)===4&&(T=c.width*.9*K),(e==null?void 0:e.modelSize)===3&&(T=c.width*.75*K),(e==null?void 0:e.modelSize)===2&&(T=c.width*.6*K),(e==null?void 0:e.modelSize)===1&&(T=c.width*.3*K),T<100?100:T},[m,c.width,e,K]);return t(re,{id:"formModal",closeOnEsc:!0,footer:ue,title:g,width:c.width>Q?Q:c.width,children:t(ce,{formSetting:!0,onError:I,formData:l,modelInfo:e,modifyData:A,onChange:(b,T)=>{d(L=>({...b}))},onForm:b=>{B(b)},...h},`${C}${e==null?void 0:e.id}`)})}),Ye=oe("confirmModal",({saveFun:s,title:i="确认删除选中的记录么?"})=>{const m=le("confirmModal"),u=r.useCallback(()=>{if(s){const p=s();if(p instanceof Promise)return p.then(o=>m.resolve(o)).finally(()=>{m.hide()});setTimeout(()=>m.resolve(p),500)}},[s]);return t(re,{id:"confirmModal",title:"操作确认",width:350,onOk:u,children:t("p",{children:i})})}),{Content:et}=O,mt=()=>{const{pathname:s}=_(),i=s.includes("/full/");return f(O,{className:"layout-page",children:[!i&&t(Je,{}),f(O,{children:[!i&&t(Qe,{}),t(et,{className:"layout-content bg-gray-50",children:t(r.Suspense,{fallback:t(xe,{message:"正在加载中"}),children:t(Te,{})})})]}),t(Xe,{}),t(Ye,{}),t(Re,{})]})};export{mt as default};
