import{r as i,o as $,au as E,k as s,l as x,f as v,j as S,F as w,av as H,aw as I}from"./index-zu87m18r.js";import{F as L,C as T,L as _}from"./confirmModal-C_kkW56o.js";import{v as G}from"./vlifeModal-CNFwsqlW.js";import{M as B}from"./ModuleHeader-12fJkJ5t.js";import{C as U}from"./styles-DZf1Ah-G.js";import{r as k,i as O,V as W,S as V,C as q,d as A,s as Q}from"./PageLayout-C8IniKvO.js";import{F as X}from"./formPage-D0LEgB12.js";import{V as Y}from"./VF-CFm92MRs.js";import{u as Z}from"./index-BmfRL-y0.js";import{v as C}from"./index-D84rZFL3.js";import"./BtnToolBar-eoxdJY99.js";import"./index-D_2oZ5Sg.js";import"./GroupLabel-CFJ4I-sR.js";import"./index-DA-42-7E.js";import"./SysApp-DRxQSclV.js";import"./SysNews-CvIX60Zj.js";import"./Tabs-COcCvxIa.js";import"./useEffectWithTarget-Dhumc1Cp.js";import"./isBrowser-DDdYk2YE.js";import"./GroupButton-DUTfCbto.js";import"./TableHeader-DYttKaXK.js";const D=k.WidthProvider(k.Responsive),ee=({value:y,onChange:m})=>{var J;const c=q,b=i.useRef(null);$();const[e,f]=i.useState(y||{}),[g,P]=i.useState(),[F,K]=i.useState({}),[a,N]=i.useState();i.useEffect(()=>{m(e)},[e]);const M=i.useMemo(()=>{var t;return((t=e==null?void 0:e.content)==null?void 0:t.some(r=>O(r)))||!1},[e]),o=i.useMemo(()=>{var t;return(t=e==null?void 0:e.content)==null?void 0:t.find(r=>r.i===a)},[a,JSON.stringify(e==null?void 0:e.content)]),d=i.useMemo(()=>{if(o&&o.component)return c[o.component]},[o]),h=i.useMemo(()=>{if((e==null?void 0:e.content)===void 0||(e==null?void 0:e.content)===null||(e==null?void 0:e.content.length)===0)return{x:0,y:0};{const t=e.content[e.content.length-1];return{x:t.x+t.w,y:t.y+t.h}}},[e]),z=i.useCallback((t,r)=>{var l;if(e){const n={pageKey:"comp"+E(6),x:h.x+(r&&r.w?r.w:1)>12?0:h.x,y:h.x+(r&&r.w?r.w:1)>12?h.y+1:h.y,w:r.w||2,h:r.h||50,name:r.label,sort:((l=e.content)==null?void 0:l.length)||0,component:t};f({...e,h:h.y,content:[...e.content?e.content:[],n]})}},[e,h.x,h.y]),R=i.useCallback(t=>{let r=0;if(e&&e.content){const l=e==null?void 0:e.content.map((p,u)=>{let j=t[u].h+t[u].y;return j>r&&(r=j),{...p,i:t[u].i,h:t[u].h,w:t[u].w,x:t[u].x,y:t[u].y}}),n={...e,h:r,content:l};f(n)}},[e]);return s("div",{className:"flex flex-col min-w-0 flex-1 overflow-hidden border-t h-full  w-full bg-sky-50  shadow ",children:x("div",{className:"flex-1 relative z-50 flex px-2  overflow-hidden  ",children:[x("div",{className:"flex w-48 flex-col space-y-2 mt-2 items-center bg-white p-2",children:[s("div",{className:"px-2 text-left  text-sm font-semibold w-full   ",children:"添加组件"}),Object.keys(c).map(t=>x("div",{className:"relative group flex w-full items-center cursor-pointer h-8 hover:bg-gray-100 hover:text-blue-600 rounded hover:font-bold",onClick:()=>{z(t,c[t])},children:[s("span",{className:" flex w-8 items-center text-gray-600 justify-start pl-2",children:c[t].icon}),s("span",{className:"flex flex-1  text-gray-600 text-sm  group-hover:text-blue-600  text-left ",children:c[t].label}),s("span",{className:" w-6  text-xl  text-gray-400 group-hover:text-blue-600",children:"+"})]},t))]}),s("main",{className:"flex-1  relative z-40 overflow-x-hidden overflow-y-auto focus:outline-none",children:x("div",{className:` ${v({"bg-slate-800":e==null?void 0:e.bigScreen})} absolute inset-0  h-full rounded`,ref:b,children:[s(D,{margin:[0,0],allowOverlap:(e==null?void 0:e.componentOver)===!0,onLayoutChange:R,className:"layout",cols:{lg:12,md:12,sm:12,xs:12,xxs:12},rowHeight:2,children:(J=e==null?void 0:e.content)==null?void 0:J.map((t,r)=>x("div",{onClick:()=>{N(t.i)},"data-grid":{...t},style:{zIndex:t.i},className:`group !z-20 cursor-pointer  ${v({"pl-1 pt-1":e.border===!0})}`,children:[x("div",{className:" !z-10  space-x-2 absolute bottom-2 right-2 hidden group-hover:block",children:[s("span",{className:"text-xs text-red-400",children:t.i===a?"编辑中":"点击编辑"}),t.i!==a&&s(S,{onClick:()=>{N(t.i)},children:"编辑"}),s(S,{onClick:l=>{var n;f({...e,content:(n=e==null?void 0:e.content)==null?void 0:n.filter(p=>p.i!==t.i).map((p,u)=>({...p,sort:u}))}),N(void 0),l.stopPropagation()},children:"删除"})]}),t.component?s(w,{children:e.border&&!O(t)?s(W,{mode:"design",design:t.i===a,bigScreen:e.bigScreen,title:t.name||"",more:t.more,children:(M&&g||M==!1)&&s(V,{card:!0,compInfo:c[t.component],onDataChange:l=>{t.pageKey&&K({...F,[t.pageKey]:l})},bigScreen:e.bigScreen,className:v("h-full"),pageComponentDto:t,h:t.h,conditions:g,onConditionsChange:P})}):s(V,{compInfo:c[t.component],onDataChange:l=>{t.pageKey&&K({...F,[t.pageKey]:l})},card:!1,bigScreen:e.bigScreen,className:v("h-full"),pageComponentDto:t,h:t.h,conditions:g,onConditionsChange:P})}):s(w,{})]},t.i||H(5)))}),(e===void 0||!e.content||e.content.length===0)&&s("div",{className:"flex  justify-center items-center h-full",children:s("span",{className:"text-xl  text-gray-500 ",children:"左侧点击添加看板组件"})})]})}),e.content&&e.content.length>0&&s("div",{className:"w-72 ml-2 bg-white",children:a?x("div",{className:" inset-0 py-6 px-4 sm:px-6 lg:p-6",children:[a!==void 0&&s(X,{terse:!0,type:"pageComponent",formData:o,reaction:[Y.result((e==null?void 0:e.border)!==!0).then("name","more").clearValue().hide()],onChange:t=>{f(r=>{var l;return{...r,content:(l=r==null?void 0:r.content)==null?void 0:l.map((n,p)=>n.pageKey===t.pageKey?{...n,name:t.name,more:t.more}:n)}})}},`formPage_${a}`),s("div",{className:"flex flex-col flex-1 w-full border-t border-gray-400 border-dashed relative ",children:d&&o&&d.props&&d.propForm===void 0?s(U,{value:o.props||[],propConf:d.props,onChange:t=>{f(r=>{var l;return{...r,content:(l=r==null?void 0:r.content)==null?void 0:l.map(n=>n.pageKey===o.pageKey?{...n,props:t}:{...n})}})}},`CompConf_${a}`):o&&d&&d.propForm&&s(w,{children:s(d.propForm,{componentProp:d.propFormComponentProp,className:" mt-4",label:d.label,onChange:t=>{f(r=>{var l;return{...r,content:(l=r==null?void 0:r.content)==null?void 0:l.map(n=>n.pageKey===o.pageKey?{...n,sysTabId:t.sysTabId,componentPropJson:JSON.stringify(I(t))}:{...n})}})},data:o.componentPropJson&&JSON.parse(o.componentPropJson),value:o.componentPropJson&&JSON.parse(o.componentPropJson)},`propForm_${a}`)})})]}):s("div",{className:" flex justify-center items-center h-full w-full text-xl text-blue-400",children:"点击看板组件进行设置"})})]})})},{Content:te}=_,Se=()=>{const[y]=Z(),[m,c]=i.useState();return i.useEffect(()=>{y.pageLayoutId&&A({id:y.pageLayoutId}).then(b=>{c(b.data||{})})},[y.pageLayoutId]),x("div",{className:"w-full h-full flex flex-col ",children:[s(B,{title:"看板设计",secondTitle:m==null?void 0:m.name,btns:s(S,{icon:s(C,{}),theme:"solid",onClick:()=>{m?Q({...m}).then(b=>{}):alert("请检查是否填写完配置信息并完成页面组件的设置")},className:"hover:bg-light-blue-200 hover:text-light-blue-800 group flex items-center rounded-md bg-light-blue-100 text-light-blue-600 text-sm font-medium px-4 py-2",children:"保存"})}),s("div",{className:" flex w-full flex-1 ",children:s(te,{className:"layout-content bg-gray-50",children:m&&s(ee,{onChange:c,value:m})})}),s(L,{}),s(T,{}),s(G,{})]})};export{Se as default};
