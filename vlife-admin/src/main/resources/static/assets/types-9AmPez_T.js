import{B as A,c as a,f as g,ag as Z,ah as q,Y,P as i,h as m,a as Q,ai as U,d as ee,aj as te,C as z,ak as se,al as oe,n as ne,a1 as b,v as R,ae as w}from"./index-zu87m18r.js";const L={PREFIX:`${A}-sidesheet`,DIALOG:`${A}-modal`},k={PLACEMENT:["top","right","bottom","left"],SIZE:["small","medium","large"],WIDTH:{small:448,medium:684,large:920},HEIGHT:448};var W=function(t,e){var s={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(s[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(s[o[n]]=t[o[n]]);return s};let ie=0;const d=L.PREFIX;class P extends a.PureComponent{constructor(){super(...arguments),this.onMaskClick=e=>{e.target===e.currentTarget&&this.close(e)},this.close=e=>{const{onClose:s}=this.props;s&&s(e)}}componentDidMount(){this.sideSheetId=`sidesheet-${ie++}`}componentWillUnmount(){clearTimeout(this.timeoutId)}getMaskElement(){var e;const{mask:s,maskStyle:o,maskClosable:n}=this.props;return s?a.createElement("div",Object.assign({"aria-hidden":!0,key:"mask",className:g(`${d}-mask`,(e=this.props.maskClassName)!==null&&e!==void 0?e:""),style:o,onClick:n?this.onMaskClick:null},this.props.maskExtraProps)):null}renderHeader(){const{title:e,closable:s,headerStyle:o,closeIcon:n}=this.props;let l,p;if(e&&(l=a.createElement("div",{className:`${d}-title`,"x-semi-prop":"title"},this.props.title)),s){const h=n||a.createElement(Y,null);p=a.createElement(Z,{className:`${d}-close`,key:"close-btn",onClick:this.close,type:"tertiary",icon:h,theme:"borderless",size:"small"})}return a.createElement("div",{className:`${d}-header`,role:"heading","aria-level":1,style:Object.assign({},o)},l,p)}getDialogElement(){var e;const s=W(this.props,[]),o={};s.width&&(o.width=s.width,s.mask||(o.width="100%")),s.height&&(o.height=s.height);const n=this.renderHeader();return a.createElement("div",Object.assign({key:"dialog-element",role:"dialog",tabIndex:-1,className:g(`${d}-inner`,`${d}-inner-wrap`,(e=this.props.dialogClassName)!==null&&e!==void 0?e:"",`${d}-size-${s.size}`),style:Object.assign(Object.assign({},s.style),o)},this.props.wrapperExtraProps),a.createElement("div",{className:`${d}-content`},n,a.createElement("div",{className:`${d}-body`,style:s.bodyStyle,"x-semi-prop":"children"},s.children),s.footer?a.createElement("div",{className:`${d}-footer`,"x-semi-prop":"footer"},s.footer):null))}render(){const e=this.props,{mask:s,className:o,width:n,onClose:l,maskStyle:p,maskClosable:h,maskClassName:r,title:x,closable:D,headerStyle:j,height:C,style:f,size:_,bodyStyle:I,dialogClassName:N,children:T,footer:M,maskExtraProps:v,wrapperExtraProps:B}=e,O=W(e,["mask","className","width","onClose","maskStyle","maskClosable","maskClassName","title","closable","headerStyle","height","style","size","bodyStyle","dialogClassName","children","footer","maskExtraProps","wrapperExtraProps"]),S=g(o,{[`${d}-fixed`]:!s,[`${d}-size-${this.props.size}`]:!s}),y={};!s&&n&&(y.width=n);const E=q(O);return a.createElement("div",Object.assign({className:S,style:y},E),this.getMaskElement(),this.getDialogElement())}}P.propTypes={onClose:i.func,closeIcon:i.node};P.defaultProps={onClose:m};class $ extends Q{constructor(e){super(Object.assign(Object.assign({},$.defaultAdapter),e)),this.toggleDisplayNone=s=>{this._adapter.toggleDisplayNone(s)}}get defaultAdapter(){return{handleCancel:m,beforeShow:m,afterHide:m}}destroy(){this.afterHide()}handleCancel(e){this._adapter.notifyCancel(e)}beforeShow(){this.getProp("disableScroll")&&this._adapter.disabledBodyScroll(),this._adapter.setOnKeyDownListener()}afterHide(){this.getProp("disableScroll")&&this._adapter.enabledBodyScroll(),this._adapter.removeKeyDownListener()}handleKeyDown(e){const{closeOnEsc:s}=this.getProps();if(s&&e.keyCode===U.ESC){e.stopPropagation(),this.handleCancel(e);return}}onVisibleChange(e){this._adapter.notifyVisibleChange(e)}}var ae=function(t,e){var s={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(s[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(s[o[n]]=t[o[n]]);return s};const c=L.PREFIX,le=k.HEIGHT;class u extends ee{constructor(e){super(e),this.handleCancel=s=>{this.foundation.handleCancel(s)},this.handleKeyDown=s=>{this.foundation.handleKeyDown(s)},this.updateState=()=>{this.foundation.toggleDisplayNone(!this.props.visible)},this.state={displayNone:!this.props.visible},this.foundation=new $(this.adapter),this.bodyOverflow="",this.scrollBarWidth=0,this.originBodyWidth="100%"}get adapter(){return Object.assign(Object.assign({},super.adapter),{disabledBodyScroll:()=>{const{getPopupContainer:e}=this.props;this.bodyOverflow=document.body.style.overflow||"",!e&&this.bodyOverflow!=="hidden"&&(document.body.style.overflow="hidden",document.body.style.width=`calc(${this.originBodyWidth||"100%"} - ${this.scrollBarWidth}px)`)},enabledBodyScroll:()=>{const{getPopupContainer:e}=this.props;!e&&this.bodyOverflow!=="hidden"&&(document.body.style.overflow=this.bodyOverflow,document.body.style.width=this.originBodyWidth)},notifyCancel:e=>{this.props.onCancel&&this.props.onCancel(e)},notifyVisibleChange:e=>{this.props.afterVisibleChange(e)},setOnKeyDownListener:()=>{window&&window.addEventListener("keydown",this.handleKeyDown)},removeKeyDownListener:()=>{window&&window.removeEventListener("keydown",this.handleKeyDown)},toggleDisplayNone:e=>{e!==this.state.displayNone&&this.setState({displayNone:e})}})}static getDerivedStateFromProps(e,s){const o={};return e.visible&&s.displayNone&&(o.displayNone=!1),!e.visible&&!e.motion&&!s.displayNone&&(o.displayNone=!0),o}componentDidMount(){this.scrollBarWidth=te(),this.originBodyWidth=document.body.style.width,this.props.visible&&this.foundation.beforeShow()}componentDidUpdate(e,s,o){!e.visible&&this.props.visible&&this.foundation.beforeShow(),e.visible&&!this.props.visible&&this.foundation.afterHide(),s.displayNone!==this.state.displayNone&&this.foundation.onVisibleChange(!this.state.displayNone)}componentWillUnmount(){this.props.visible&&this.foundation.destroy()}renderContent(){const e=this.props,{placement:s,className:o,children:n,width:l,height:p,motion:h,visible:r,style:x,maskStyle:D,size:j,zIndex:C,getPopupContainer:f,keepDOM:_}=e,I=ae(e,["placement","className","children","width","height","motion","visible","style","maskStyle","size","zIndex","getPopupContainer","keepDOM"]);let N={zIndex:C};f&&(N={zIndex:C,position:"static"});const{direction:T}=this.context,M=s==="left"||s==="right",v=s==="top"||s==="bottom",B=v?p||le:"100%",O=g(c,o,{[`${c}-${s}`]:s,[`${c}-popup`]:f,[`${c}-horizontal`]:v,[`${c}-rtl`]:T==="rtl",[`${c}-hidden`]:_&&this.state.displayNone}),S=Object.assign(Object.assign(Object.assign({},M?l?{width:l}:{}:{width:"100%"}),I),{visible:r,motion:!1,size:j,className:O,height:B,onClose:this.handleCancel}),y=this.props.visible||this.props.keepDOM||this.props.motion&&!this.state.displayNone;return a.createElement(z,{motion:this.props.motion,animationState:r?"enter":"leave",startClassName:r?`${c}-animation-mask_show`:`${c}-animation-mask_hide`,onAnimationEnd:this.updateState},E=>{let{animationClassName:V,animationEventsNeedBind:F}=E;return a.createElement(z,{motion:this.props.motion,animationState:r?"enter":"leave",startClassName:r?`${c}-animation-content_show_${this.props.placement}`:`${c}-animation-content_hide_${this.props.placement}`,onAnimationEnd:this.updateState},K=>{let{animationClassName:G,animationStyle:X,animationEventsNeedBind:J}=K;return y?a.createElement(se,{getPopupContainer:f,style:N},a.createElement(P,Object.assign({},S,{maskExtraProps:F,wrapperExtraProps:J,dialogClassName:G,maskClassName:V,maskStyle:Object.assign({},D),style:Object.assign(Object.assign({},X),x)}),n)):a.createElement(a.Fragment,null)})})}render(){return this.props,this.renderContent()}}u.contextType=oe;u.propTypes={bodyStyle:i.object,headerStyle:i.object,children:i.node,className:i.string,closable:i.bool,disableScroll:i.bool,getPopupContainer:i.func,height:i.oneOfType([i.number,i.string]),mask:i.bool,maskClosable:i.bool,maskStyle:i.object,motion:i.oneOfType([i.bool,i.object,i.func]),onCancel:i.func,placement:i.oneOf(k.PLACEMENT),size:i.oneOf(k.SIZE),style:i.object,title:i.node,visible:i.bool,width:i.oneOfType([i.number,i.string]),zIndex:i.number,afterVisibleChange:i.func,closeOnEsc:i.bool,footer:i.node,keepDOM:i.bool,"aria-label":i.string};u.__SemiComponentName__="SideSheet";u.defaultProps=ne(u.__SemiComponentName__,{visible:!1,motion:!0,mask:!0,placement:"right",closable:!0,footer:null,zIndex:1e3,maskClosable:!0,size:"small",disableScroll:!0,closeOnEsc:!1,afterVisibleChange:m,keepDOM:!1});const re=(t,e,...s)=>{for(const o of s)if(!de(t,o,e))return!1;return!0},de=(t,e,s)=>{if(t.length===0)return!0;for(const o of t)if(pe(o,e,s))return!0;return!1},pe=(t,e,s)=>{const o=t.where;for(const n of o)if(Array.isArray(e)){if(!e.every(p=>H(n,p,s)))return!1}else if(!H(n,e,s))return!1;return!0},H=(t,e,s)=>{var o,n,l;return t.fieldName&&t.opt===b.eq?((o=t.value)==null?void 0:o[0])==="${currUser}"&&e[t.fieldName]===(s==null?void 0:s.id)?!0:e[t.fieldName]===((n=t.value)==null?void 0:n[0]):t.fieldName&&t.opt===b.ne&&e[t.fieldName]!==((l=t.value)==null?void 0:l[0])||t.fieldName&&t.opt===b.isNotNull&&e[t.fieldName]!==null?!0:!!(t.fieldName&&t.opt===b.isNull&&e[t.fieldName]===null)},he=(t,e,s)=>{var p,h;const o=((p=t.sysResources)==null?void 0:p.paramGeneric)||((h=t.sysResources)==null?void 0:h.paramWrapper),n=t.sysResources.paramWrapper.indexOf("[]")!==-1||t.sysResources.paramWrapper==="List";return{...t,buttonVo:t,multiple:n,usableMatch:r=>t.conditionJson?re(JSON.parse(t.conditionJson),e,r):!0,sysResources:t.sysResources,model:(t.actionType==="create"||t.actionType==="edit")&&o?R(o):void 0,saveApi:r=>{if(t.sysResources.methedType.indexOf("PostMapping")!==-1)return w.post(t.sysResources.url,r,{headers:{"Content-Type":"application/json",buttonId:t.id}});if(t.sysResources.methedType.indexOf("DeleteMapping")!==-1)return w.delete(t.sysResources.url,{data:r,headers:{"Content-Type":"application/json",buttonId:t.id}})},loadApi:t.actionType==="edit"&&t.model&&t.model!==s?({id:r})=>w.get(`/${R(t.model)}/detail/${r}`):void 0}};export{u as S,he as d};
