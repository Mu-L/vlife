import{B as te,c as h,an as z,az as re,f as j,ah as se,P as p,r as d,o as ne,u as ie,l as w,k as u,y as oe,j as ae}from"./index-zu87m18r.js";import{w as L,u as D,x as le,j as ce,N as I}from"./index-D84rZFL3.js";import{F as de}from"./formPage-D0LEgB12.js";import{B as ue}from"./BtnToolBar-eoxdJY99.js";import{u as pe}from"./GroupLabel-CFJ4I-sR.js";const k={PREFIX:`${te}-layout`},he={BREAKPOINT:["xs","sm","md","lg","xl","xxl"]},W=h.createContext({siderHook:{addSider:z,removeSider:z}});var me=function(t,r){var s={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.indexOf(e)<0&&(s[e]=t[e]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,e=Object.getOwnPropertySymbols(t);n<e.length;n++)r.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(t,e[n])&&(s[e[n]]=t[e[n]]);return s};const A={xs:"(max-width: 575px)",sm:"(min-width: 576px)",md:"(min-width: 768px)",lg:"(min-width: 992px)",xl:"(min-width: 1200px)",xxl:"(min-width: 1600px)"},fe=(()=>{let t=0;return()=>(t+=1,`${k.PREFIX}-sider-${t}`)})(),ye=he.BREAKPOINT;class O extends h.PureComponent{constructor(r){super(r),this.unRegisters=[],this.uniqueId="",this.uniqueId=fe()}componentDidMount(){const{breakpoint:r}=this.props,e=Object.keys(A).filter(n=>r&&r.indexOf(n)!==-1).map(n=>re(A[n],{match:()=>{this.responsiveHandler(n,!0)},unmatch:()=>{this.responsiveHandler(n,!1)}}));this.unRegisters=e,this.context.siderHook&&this.context.siderHook.addSider(this.uniqueId)}componentWillUnmount(){this.unRegisters.forEach(r=>r()),this.context.siderHook&&this.context.siderHook.removeSider(this.uniqueId)}responsiveHandler(r,s){const{onBreakpoint:e}=this.props;e&&e(r,s)}render(){const r=this.props,{prefixCls:s,className:e,children:n,style:f}=r,m=me(r,["prefixCls","className","children","style"]),x=j(e,{[`${s}-sider`]:!0});return h.createElement("aside",Object.assign({className:x,"aria-label":this.props["aria-label"],style:f},se(m)),h.createElement("div",{className:`${s}-sider-children`},n))}}O.propTypes={prefixCls:p.string,style:p.object,className:p.string,breakpoint:p.arrayOf(p.oneOf(ye)),onBreakpoint:p.func,"aria-label":p.string,role:p.string};O.defaultProps={prefixCls:k.PREFIX};O.contextType=W;O.elementType="Layout.Sider";var X=function(t,r){var s={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.indexOf(e)<0&&(s[e]=t[e]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,e=Object.getOwnPropertySymbols(t);n<e.length;n++)r.indexOf(e[n])<0&&Object.prototype.propertyIsEnumerable.call(t,e[n])&&(s[e[n]]=t[e[n]]);return s};const xe={Header:"header",Footer:"footer",Content:"main",Layout:"section"};function H(t){const r=xe[t],s=t.toLowerCase();return e=>class extends h.PureComponent{render(){return h.createElement(e,Object.assign({role:this.props.role,"aria-label":this.props["aria-label"],type:s,tagName:r},this.props))}}}class P extends h.PureComponent{render(){const r=this.props,{prefixCls:s,type:e,className:n,children:f,tagName:m}=r,x=X(r,["prefixCls","type","className","children","tagName"]),y=j(n,`${s}-${e}`);return h.createElement(m,Object.assign({className:y},x),f)}}P.propTypes={prefixCls:p.string,style:p.object,className:p.string};P.defaultProps={prefixCls:k.PREFIX};const ge=H("Header")(P),Se=H("Footer")(P),Ce=H("Content")(P);class N extends h.Component{constructor(r){super(r),this.state={siders:[]}}getSiderHook(){return{addSider:r=>{this.setState(s=>({siders:[...s.siders,r]}))},removeSider:r=>{this.setState(s=>({siders:s.siders.filter(e=>e!==r)}))}}}render(){const r=this.props,{prefixCls:s,className:e,children:n,hasSider:f,tagName:m}=r,x=X(r,["prefixCls","className","children","hasSider","tagName"]),{siders:y}=this.state,M=j(e,s,{[`${s}-has-sider`]:typeof f=="boolean"&&f||y.length>0||h.Children.toArray(n).some(E=>h.isValidElement(E)&&E.type&&E.type.elementType==="Layout.Sider")}),l=m;return h.createElement(W.Provider,{value:{siderHook:this.getSiderHook()}},h.createElement(l,Object.assign({className:M},x),n))}}N.propTypes={prefixCls:p.string,style:p.object,className:p.string};N.defaultProps={prefixCls:k.PREFIX,tagName:"section"};N.Header=ge;N.Footer=Se;N.Content=Ce;N.Sider=O;const je=L("formModal",({modelInfo:t,formData:r,width:s,activeKey:e,onError:n,formDesign:f=!1,btns:m,modifyData:x,...y})=>{var $;const M=D("formModal"),[l,E]=d.useState({width:window.screen.width,height:window.screen.height}),q=ne(),{user:F}=ie(),[g,J]=d.useState(($=m==null?void 0:m[0])==null?void 0:$.continueCreate),[c,T]=d.useState(r),[K,U]=d.useState(0),[Q,_]=d.useState();d.useEffect(()=>{_(x)},[x]);const[S,G]=d.useState(),[we,Y]=d.useState([]),{model:Z}=pe(t?{}:{type:y.type}),i=t||Z,V=d.useMemo(()=>{var v;const o=(c==null?void 0:c.no)||"";if(y.title)return y.title;if(i===void 0)return`“${y.type}”模型标识不存在`;const a=(i==null?void 0:i.title)||i.type;return y.readPretty?a+"详情"+o:(v=S==null?void 0:S.values)!=null&&v.id?a+o:"新建("+a+")"},[c,S,i]),C=d.useMemo(()=>m&&S?m.map(o=>({...o,btnType:"button",position:"formFooter",datas:{...c},onSubmitFinish:a=>{g===!0||g===void 0&&o.continueCreate===!0?(T(void 0),U(v=>v+1)):(T(a),_(a)),o.onSubmitFinish&&o.onSubmitFinish(a)},onFormilySubmitCheck:()=>S.submit().then(a=>!0).catch(a=>!1)})):[],[m,S,i,c,g]),B=C.filter(o=>o.actionType==="create"&&o.continueCreate!==void 0),ee=d.useMemo(()=>C&&C.length>0?w("div",{className:"flex w-full justify-end relative h-full items-center  space-x-2",children:[f===!1&&(F==null?void 0:F.superUser)===!0&&w("div",{className:"flex flex-1    font-normal space-x-4  items-center justify-start ",children:[w("div",{onClick:()=>{d.startTransition(()=>{q(`/full/formDesign/${i.type}`)})},className:" cursor-pointer flex hover:text-blue-500 items-center space-x-1",children:[u(le,{size:"small"}),u("span",{children:"表单配置"})]}),c&&u(oe,{content:w("pre",{className:"p-2",children:[" ",JSON.stringify(c,null,2)]}),children:w("div",{className:" cursor-pointer flex hover:text-blue-500 items-center space-x-1",children:[u("i",{className:"  icon-eye"})," ",u("span",{children:"JSON数据"})]})})]}),B.length>0&&w("div",{className:"absolute flex left-2 items-center",children:[u("span",{className:`text-gray-400 ${j({"!text-gray-800":g!==void 0?g:B[0].continueCreate})}`,children:"连续新增"}),u(ce,{checked:g!==void 0?g:B[0].continueCreate,onChange:o=>{J(o)},checkedText:"开",uncheckedText:"关"})]}),C.length>0?u(ue,{datas:[(c==null?void 0:c.flow)!==void 0?c:{...c}],btns:C.map(o=>({...o,modalOpen:!0})),entity:t==null?void 0:t.entityType,activeKey:e,dataType:t==null?void 0:t.type,position:"formFooter",btnType:"button"}):u(ae,{onClick:()=>{M.hide()},children:"关闭"})]}):u("div",{}),[C,c,S,g]),b=d.useMemo(()=>l.width<=1280?1:l.width<=1600?.9:l.width<=1920?.8:l.width<=2560?.65:l.width<=3840?.55:l.width<=5120?.45:.4,[l]),R=d.useMemo(()=>{if(s)return s;let a=0;return(i==null?void 0:i.modelSize)===4&&(a=l.width*.9*b),(i==null?void 0:i.modelSize)===3&&(a=l.width*.75*b),(i==null?void 0:i.modelSize)===2&&(a=l.width*.6*b),(i==null?void 0:i.modelSize)===1&&(a=l.width*.3*b),a<100?100:a},[s,l.width,i,b]);return u(I,{id:"formModal",closeOnEsc:!0,footer:ee,title:V,width:l.width>R?R:l.width,children:u(de,{formSetting:!0,onError:Y,formData:c,modelInfo:i,modifyData:Q,onChange:(o,a)=>{T(v=>({...o}))},onForm:o=>{G(o)},...y},`${K}${i==null?void 0:i.id}`)})}),ke=L("confirmModal",({saveFun:t,title:r="确认删除选中的记录么?"})=>{const s=D("confirmModal"),e=d.useCallback(()=>{if(t){const n=t();if(n instanceof Promise)return n.then(f=>s.resolve(f)).finally(()=>{s.hide()});setTimeout(()=>s.resolve(n),500)}},[t]);return u(I,{id:"confirmModal",title:"操作确认",width:350,onOk:e,children:u("p",{children:r})})});export{ke as C,je as F,N as L};
