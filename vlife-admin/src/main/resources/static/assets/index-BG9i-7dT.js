import{B as z,r as b,f as g,l as n,P as T,k as s,o as Y,Y as q,F as G,T as U}from"./index-zu87m18r.js";import{r as J,s as K}from"./index-D84rZFL3.js";import{u as j,d as Q,G as W}from"./GroupLabel-CFJ4I-sR.js";import{b as Z,c as ee,s as te,F as se}from"./formPage-D0LEgB12.js";import{u as ie}from"./index-BmfRL-y0.js";import{B as le}from"./BtnToolBar-eoxdJY99.js";import{sysFields as w}from"./index-BDw9aBS1.js";import"./index-DA-42-7E.js";import"./index-D_2oZ5Sg.js";import"./VF-CFm92MRs.js";import"./SysApp-DRxQSclV.js";import"./isBrowser-DDdYk2YE.js";import"./useEffectWithTarget-Dhumc1Cp.js";const ae={PREFIX:`${z}-card`};var ne=function(p,d){var l={};for(var c in p)Object.prototype.hasOwnProperty.call(p,c)&&d.indexOf(c)<0&&(l[c]=p[c]);if(p!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,c=Object.getOwnPropertySymbols(p);h<c.length;h++)d.indexOf(c[h])<0&&Object.prototype.propertyIsEnumerable.call(p,c[h])&&(l[c[h]]=p[c[h]]);return l};const $=ae.PREFIX;class E extends b.PureComponent{render(){const d=this.props,{avatar:l,className:c,description:h,style:k,title:v}=d,t=ne(d,["avatar","className","description","style","title"]),N=g(`${$}-meta`,c),y=l&&s("div",{className:`${$}-meta-avatar`,children:l}),C=v&&s("div",{className:`${$}-meta-wrapper-title`,children:v}),_=h&&s("div",{className:`${$}-meta-wrapper-description`,children:h}),I=v||h?n("div",{className:`${$}-meta-wrapper`,children:[C,_]}):null;return n("div",{...Object.assign({},t,{className:N,style:k}),children:[y,I]})}}E.propTypes={avatar:T.node,className:T.string,description:T.node,style:T.object,title:T.node};const re=Z(({field:p,onRemove:d})=>{const l=te(()=>s("i",{className:" icon-rank cursor-move font-thin items-center"}));return n("div",{style:{zIndex:"2000"},className:" w-full font-normal text-sm group mb-1  p-2 flex justify-between border rounded border-gray-300  hover:border-blue-500 ",children:[n("div",{children:[p.title,s("span",{className:" text-xs ml-2 font-bold text-blue-500",children:p.fieldName})]}),n("div",{className:" items-center space-x-1 hidden group-hover:block",children:[s(l,{}),s(J,{className:" font-thin ",onClick:c=>{d(p)}})]})]})}),de=ee(({fields:p,onRemove:d,className:l})=>s("div",{className:l,onMouseDown:c=>c.preventDefault(),children:p==null?void 0:p.map((c,h)=>s(re,{index:h,field:c,onRemove:d},`item-${h}`))})),we=()=>{var P,F,O,B,D,H,R,L,M,X,A;b.useEffect(()=>{console.log("dto")},[]);const p=Y(),[d]=ie(),{model:l}=j({id:d==null?void 0:d.modelId}),[c,h]=b.useState();b.useEffect(()=>{Q().then(e=>{var i;h((i=e.data)==null?void 0:i.find(o=>o.id===(d==null?void 0:d.modelId)))})},[]);const{models:k}=j({types:c==null?void 0:c.subs}),{model:v}=j({id:d==null?void 0:d.dtoId}),[t,N]=b.useState({});b.useEffect(()=>{N({...v})},[v]);const[y,C]=b.useState("basic"),_=({oldIndex:e,newIndex:i,items:o})=>{const m=[...o],[x]=m.splice(e,1);return m.splice(i,0,x),m},I=b.useCallback(()=>{const e=`/modelDesign/detail?appId=${d.appId}&modelId=${d.modelId}`;p(e)},[]);return n("div",{className:" w-full h-full flex  flex-col p-2",children:[n("div",{className:" mb-2 h-10 flex items-center p-2 justify-between rounded-md bg-white  ",children:[s(le,{btns:[{title:"返回",actionType:"create",icon:s("i",{className:"  icon-backspace"}),disabledHide:!0,onClick:I}]}),s(q,{className:"!cursor-pointer absolute right-4 hover:text-blue-500 mx-2",onClick:I})]}),n("div",{className:" w-full flex-1 flex space-x-2",children:[n("div",{className:"2xl:w-72 w-52 h-full border rounded p-2 transition-shadow duration-300 hover:shadow-2xl !bg-gray-50 ",children:[n("div",{className:" w-full space-x-1 flex 2xl:flex-row  flex-col",children:[s(E,{onClick:()=>{C("basic")},title:s("span",{className:"  text-sm",children:"基础字段"}),description:n("span",{className:"text-xs",children:["已选",((P=l==null?void 0:l.fields)==null?void 0:P.filter(e=>!w.includes(e.fieldName)).filter(e=>{var i,o;return(o=(i=t==null?void 0:t.fields)==null?void 0:i.map(m=>m.fieldName))==null?void 0:o.includes(e.fieldName)}).length)||0,"字段"]}),avatar:s("i",{className:" icon-extension"}),className:` !p-2 !border hover:shadow  !rounded-md !cursor-pointer ${g({"bg-blue-100":y==="basic"})}  `}),s(E,{onClick:()=>{C("sub")},title:s("span",{className:"  text-sm",children:"1对多子表"}),description:n("span",{className:" text-xs",children:["已关联",((O=(F=t==null?void 0:t.fields)==null?void 0:F.filter(e=>e.dataType!=="basic"))==null?void 0:O.length)||0,"个模型"]}),avatar:s("i",{className:" icon-subtable"}),className:`!p-2 !border  hover:shadow  !rounded-md !cursor-pointer ${g({"bg-blue-100":y==="sub"," hover:bg-blue-100":y!=="sub"})}  `})]}),s("div",{className:" text-left text-xs text-red-400 pt-2",children:y==="basic"?"从实体模型选择当前表单需要的字段":""}),y==="basic"?(H=(D=(B=l==null?void 0:l.fields)==null?void 0:B.sort((e,i)=>e.sort-i.sort))==null?void 0:D.filter(e=>!w.includes(e.fieldName)))==null?void 0:H.map(e=>{var x;let i={...e,id:void 0},o=(x=t==null?void 0:t.fields)==null?void 0:x.find(a=>a.fieldName===e.fieldName);o&&(i=o);const m=o!==void 0;return n("div",{onClick:()=>{N(m?a=>{var u;return{...a,fields:(u=a==null?void 0:a.fields)==null?void 0:u.filter(r=>r.fieldName!==e.fieldName).map((r,f)=>({...r,sort:f+1}))}}:a=>{var u;return{...a,fields:[...(a==null?void 0:a.fields)||[],{...i,sort:(((u=a==null?void 0:a.fields)==null?void 0:u.length)||0)+1}]}})},className:`${g({"  border rounded border-blue-500 bg-blue-50  text-blue-500 font-medium transition-colors duration-200 ease-in-out":m,"border-gray-300 text-gray-500":!m})} relative w-full font-normal mb-1 text-sm  cursor-pointer group p-2 flex justify-between items-center border rounded hover:border-blue-400`,children:[n("div",{className:"flex items-center space-x-2",children:[m?s("i",{className:" icon-calendar-check"}):s("i",{className:"  icon-check_box"}),s("span",{children:i.title})]}),i.fieldType==="string"&&s("i",{className:"icon-task_custom_text-box"}),i.fieldType==="date"&&s("i",{className:"  icon-task_custom_date_range3"}),i.fieldType==="number"&&s("i",{className:" icon-worksheet_numerical"}),i.fieldType==="boolean"&&s("i",{className:" icon-checkbox_01"})]},i.fieldName)}):s("div",{className:"flex flex-col items-center justify-center",children:k&&k.length>0?k.map(e=>{var i,o,m,x,a,u;return s("div",{onClick:()=>{var r;(r=t==null?void 0:t.fields)!=null&&r.map(f=>f.fieldName).includes(e.type)?N(f=>({...f,fields:[...((f==null?void 0:f.fields)||[]).filter(S=>S.fieldType!==e.type)]})):N(f=>{var S;return{...f,fields:[...((f==null?void 0:f.fields)||[]).filter(V=>V.entityType!==e.entityType),{dataType:"array",fieldName:e.type,pathName:e.type,fieldType:e.type,javaType:e.typeClass,entityType:e.entityType,x_decorator_props$gridSpan:2,x_component:"SubTable",title:e.title,sort:(((S=f==null?void 0:f.fields)==null?void 0:S.length)||0)+1}]}})},className:`${g({"  border  bg-blue-50 text-blue-500 border-blue-500 transition-colors duration-200 ease-in-out":(i=t==null?void 0:t.fields)==null?void 0:i.map(r=>r.fieldType).includes(e.type),"border-gray-300":!1})} relative w-full font-normal mb-1 text-sm  cursor-pointer group p-2 flex justify-between items-center border rounded hover:border-blue-500`,children:(o=t==null?void 0:t.fields)!=null&&o.map(r=>r.fieldType).includes(e.type)?n(G,{children:[n("div",{className:" text-left",children:[s("div",{children:e.title}),s("div",{className:"text-xs text-gray-500",children:e.type})]}),n("div",{className:"text-xs text-gray-500 flex flex-col space-y-2",children:[s(U,{content:"表单方式关联创建子表数据",position:"right",children:n("div",{className:" h-1/2 flex items-center",onClick:r=>{r.stopPropagation()},children:[s("i",{className:`${g({"icon-radio":(m=t==null?void 0:t.fields)==null?void 0:m.map(r=>r.fieldName).includes(e.type),"icon-not_checked ":!((x=t==null?void 0:t.fields)!=null&&x.map(r=>r.fieldName).includes(`${e.type}_${l==null?void 0:l.type}Id`))})}
                                    `}),s("span",{children:"列表新增"})]})}),s(U,{content:"创建主表的数据的同时，选择已有子表数据关联",position:"right",children:n("div",{className:" h-1/2 flex items-center",onClick:r=>{r.stopPropagation()},children:[s("i",{className:`${g({"icon-radio":(a=t==null?void 0:t.fields)==null?void 0:a.map(r=>r.fieldName).includes(e.type),"icon-not_checked ":!((u=t==null?void 0:t.fields)!=null&&u.map(r=>r.fieldName).includes(e.type))})}
                                    `}),s("span",{children:"下拉选择"})]})})]})]}):n(G,{children:[s("div",{children:e.title}),s("div",{className:"text-xs text-gray-500",children:e.type})]})},e.type)}):s("span",{className:"text-xs text-red-500 font-bold ",children:"* "+(l==null?void 0:l.title)+"没有子表"})})]}),n("div",{className:"2xl:w-72 w-52 h-full border rounded p-4 transition-shadow duration-300 hover:shadow-2xl ",children:[s(W,{text:`已选(${((L=(R=t.fields)==null?void 0:R.filter(e=>!w.includes(e.fieldName)))==null?void 0:L.length)||0})字段`,desc:n("span",{className:" text-center",children:[s("i",{className:" icon-rank cursor-move font-thin items-center"}),"改变顺序"]})}),s(de,{className:"mt-2",fields:((X=(M=t.fields)==null?void 0:M.sort((e,i)=>e.sort-i.sort))==null?void 0:X.filter(e=>!w.includes(e.fieldName)))||[],useDragHandle:!0,onSortEnd:({oldIndex:e,newIndex:i})=>{N(o=>{var m,x;return{...o,fields:[..._({oldIndex:e,newIndex:i,items:[...((m=o==null?void 0:o.fields)==null?void 0:m.filter(a=>!w.includes(a.fieldName)))||[],...((x=t.fields)==null?void 0:x.filter(a=>w.includes(a.fieldName)))||[]]}).map((a,u)=>({...a,sort:u+1}))]}})},onRemove:e=>{N(i=>{var o;return{...i,fields:(o=i==null?void 0:i.fields)==null?void 0:o.filter(m=>m.fieldName!==e.fieldName)}})}})]}),n("div",{className:"flex flex-col flex-1 p-4  bg-gray-50",children:[s("div",{className:" flex h-8 w-full border-b text-red-300 font-medium items-center mb-4 px-2 text-sm",children:"当前预览仅需关注布局顺序即可，表单组件配置在提交后通过表单设计器完成。"}),t&&(t==null?void 0:t.fields)&&(t==null?void 0:t.fields.length)>0&&s(se,{formSetting:!1,className:" bg-white p-8 rounded-md",modelInfo:K.cloneDeep({...t,fields:t==null?void 0:t.fields.map(e=>({...e,x_display:void 0}))})},(A=t==null?void 0:t.fields)==null?void 0:A.map(e=>e.id).join(""))]})]})]})};export{we as default};
