import{B as x,a as D,d as R,c as i,y as $,f as _,L as T,j as P,i as L,aj as A,am as U,P as f,an as C,r as N,k,F as M}from"./index-zu87m18r.js";import{M as G,q as X}from"./index-D84rZFL3.js";import{b as j}from"./BtnToolBar-eoxdJY99.js";import{i as B,a as z,b as V}from"./isBrowser-DDdYk2YE.js";const v={PREFIX:`${x}-userGuide`,PREFIX_MODAL:`${x}-userGuide-modal`},F={MODE:["popup","modal"],POSITION_SET:["top","topLeft","topRight","left","leftTop","leftBottom","right","rightTop","rightBottom","bottom","bottomLeft","bottomRight","leftTopOver","rightTopOver"],THEME:["default","primary"]},I={DEFAULT_CURRENT:0,DEFAULT_SPOTLIGHT_PADDING:5,DEFAULT_Z_INDEX:1030};class H extends D{constructor(r){super(Object.assign({},r)),this.handlePrev=()=>{const{current:n}=this.getStates(),e=n-1;this.getIsControlledComponent()||this._adapter.setCurrent(e),this._notifyChange(e),this._adapter.notifyPrev(e)},this.handleNext=()=>{const{steps:n}=this.getProps(),{current:e}=this.getStates(),t=e===n.length-1,o=t?e:e+1;t?this._adapter.notifyFinish():(this._notifyChange(o),this._adapter.notifyNext(o),this.getIsControlledComponent()||this._adapter.setCurrent(o))},this.handleSkip=()=>{this._adapter.notifySkip()}}init(){}destroy(){this._adapter.enabledBodyScroll()}_notifyChange(r){const{current:n}=this.getStates();n!==r&&this._adapter.notifyChange(r)}getIsControlledComponent(){return this._isInProps("current")}beforeShow(){this._adapter.disabledBodyScroll()}afterHide(){this._adapter.enabledBodyScroll()}getFinalPaading(){var r;const{spotlightPadding:n,steps:e}=this.getProps(),{current:t}=this.getStates(),o=(r=e[t])===null||r===void 0?void 0:r.spotlightPadding;return typeof o=="number"?o:typeof n=="number"?n:I.DEFAULT_SPOTLIGHT_PADDING}}var W=function(h,r,n,e){function t(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function c(l){try{p(e.next(l))}catch(g){a(g)}}function d(l){try{p(e.throw(l))}catch(g){a(g)}}function p(l){l.done?o(l.value):t(l.value).then(c,d)}p((e=e.apply(h,r||[])).next())})};const b=v.PREFIX;class O extends R{constructor(r){super(r),this.renderStep=(n,e)=>{const{theme:t,position:o,visible:a,className:c,style:d,spotlightPadding:p}=this.props,{current:l}=this.state,g=l===e;if(!n.target)return null;const y={padding:0},s=(typeof n.target=="function"?n.target():n.target).getBoundingClientRect(),u=(n==null?void 0:n.spotlightPadding)||p||I.DEFAULT_SPOTLIGHT_PADDING,S=t==="primary"||(n==null?void 0:n.theme)==="primary"?{backgroundColor:"var(--semi-color-primary)"}:{};return i.createElement($,{key:`userGuide-popup-${e}`,className:_(`${b}-popover`,c),style:Object.assign(Object.assign(Object.assign({},y),S),d),content:this.renderPopupContent(n,e),position:n.position||o,trigger:"custom",visible:a&&g,showArrow:n.showArrow!==!1},i.createElement("div",{style:{position:"fixed",left:s.x-u,top:s.y-u,width:s.width+u*2,height:s.height+u*2,pointerEvents:"none"}}))},this.renderIndicator=()=>{const{steps:n}=this.props,{current:e}=this.state,t=[];for(let o=0;o<n.length;o++)t.push(i.createElement("span",{key:o,"data-index":o,className:_([`${v.PREFIX_MODAL}-indicator-item`],{[`${v.PREFIX_MODAL}-indicator-item-active`]:o===e})}));return t},this.renderModal=()=>{const{visible:n,steps:e,showSkipButton:t,showPrevButton:o,finishText:a,nextButtonProps:c,prevButtonProps:d,mask:p}=this.props,{current:l}=this.state,g=e[l],y=l===0,m=l===e.length-1,{cover:s,title:u,description:E}=g;return i.createElement(T,{componentName:"UserGuide"},(S,w)=>i.createElement(G,{className:v.PREFIX_MODAL,bodyStyle:{padding:0},header:null,visible:n,maskClosable:!1,mask:p,centered:!0,footer:null},s&&i.createElement(i.Fragment,null,i.createElement("div",{className:`${v.PREFIX_MODAL}-cover`},s),i.createElement("div",{className:`${v.PREFIX_MODAL}-indicator`},this.renderIndicator())),(u||E)&&i.createElement("div",{className:`${v.PREFIX_MODAL}-body`},u&&i.createElement("div",{className:`${v.PREFIX_MODAL}-body-title`},u),E&&i.createElement("div",{className:`${v.PREFIX_MODAL}-body-description`},E)),i.createElement("div",{className:`${v.PREFIX_MODAL}-footer`},t&&!m&&i.createElement(P,{type:"tertiary",onClick:this.foundation.handleSkip},S.skip),o&&!y&&i.createElement(P,Object.assign({type:"tertiary",onClick:this.foundation.handlePrev},d),(d==null?void 0:d.children)||S.prev),i.createElement(P,Object.assign({theme:"solid",onClick:this.foundation.handleNext},c),m?a||S.finish:(c==null?void 0:c.children)||S.next))))},this.foundation=new H(this.adapter),this.state={current:r.current||I.DEFAULT_CURRENT,spotlightRect:null},this.scrollBarWidth=0,this.userGuideId=""}get adapter(){return Object.assign(Object.assign({},super.adapter),{disabledBodyScroll:()=>{const{getPopupContainer:r}=this.props;this.bodyOverflow=document.body.style.overflow||"",!r&&this.bodyOverflow!=="hidden"&&(document.body.style.overflow="hidden",document.body.style.width=`calc(${this.originBodyWidth||"100%"} - ${this.scrollBarWidth}px)`)},enabledBodyScroll:()=>{const{getPopupContainer:r}=this.props;!r&&this.bodyOverflow!=="hidden"&&(document.body.style.overflow=this.bodyOverflow,document.body.style.width=this.originBodyWidth)},notifyChange:r=>{this.props.onChange(r)},notifyFinish:()=>{this.props.onFinish()},notifyNext:r=>{this.props.onNext(r)},notifyPrev:r=>{this.props.onPrev(r)},notifySkip:()=>{this.props.onSkip()},setCurrent:r=>{this.setState({current:r})}})}static getDerivedStateFromProps(r,n){const e={};return!L(r.current)&&r.current!==n.current&&(e.current=r.current),e}componentDidMount(){this.foundation.init(),this.scrollBarWidth=A(),this.userGuideId=U()}componentDidUpdate(r,n){const{steps:e,mode:t,visible:o}=this.props,{current:a}=this.state;o!==r.visible&&(o?(this.foundation.beforeShow(),this.setState({current:0})):this.foundation.afterHide()),(t==="popup"&&n.current!==a&&e[a]||r.visible!==o)&&this.updateSpotlightRect()}componentWillUnmount(){this.foundation.destroy()}scrollTargetIntoViewIfNeeded(r){if(!r)return;const n=r.getBoundingClientRect();n.top>=0&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)||r.scrollIntoView({behavior:"auto",block:"center"})}updateSpotlightRect(){return W(this,void 0,void 0,function*(){const{steps:r,spotlightPadding:n}=this.props,{current:e}=this.state,t=r[e];if(t.target){const o=typeof t.target=="function"?t.target():t.target;this.scrollTargetIntoViewIfNeeded(o);const a=o==null?void 0:o.getBoundingClientRect(),c=(t==null?void 0:t.spotlightPadding)||n||I.DEFAULT_SPOTLIGHT_PADDING,d=new DOMRect(a.x-c,a.y-c,a.width+c*2,a.height+c*2);requestAnimationFrame(()=>{this.setState({spotlightRect:d})})}})}renderPopupContent(r,n){const{showPrevButton:e,showSkipButton:t,theme:o,steps:a,finishText:c,nextButtonProps:d,prevButtonProps:p}=this.props,{current:l}=this.state,g=n===0,y=n===a.length-1,m=`${b}-popup-content`,s=o==="primary"||(r==null?void 0:r.theme)==="primary",{cover:u,title:E,description:S}=r;return i.createElement(T,{componentName:"UserGuide"},(w,K)=>i.createElement("div",{className:_(`${m}`,{[`${m}-primary`]:s})},u&&i.createElement("div",{className:`${m}-cover`},u),i.createElement("div",{className:`${m}-body`},E&&i.createElement("div",{className:`${m}-title`},E),S&&i.createElement("div",{className:`${m}-description`},S),i.createElement("div",{className:`${m}-footer`},a.length>1&&i.createElement("div",{className:`${m}-indicator`},l+1,"/",a.length),i.createElement("div",{className:`${m}-buttons`},t&&!y&&i.createElement(P,{style:s?{backgroundColor:"var(--semi-color-fill-2)"}:{},theme:s?"solid":"light",type:s?"primary":"tertiary",onClick:this.foundation.handleSkip},w.skip),e&&!g&&i.createElement(P,Object.assign({style:s?{backgroundColor:"var(--semi-color-fill-2)"}:{},theme:s?"solid":"light",type:s?"primary":"tertiary",onClick:this.foundation.handlePrev},p),(p==null?void 0:p.children)||w.prev),i.createElement(P,Object.assign({style:s?{backgroundColor:"#FFF"}:{},theme:s?"borderless":"solid",type:"primary",onClick:this.foundation.handleNext},d),y?c||w.finish:(d==null?void 0:d.children)||w.next))))))}renderSpotlight(){const{steps:r,mask:n,zIndex:e}=this.props,{spotlightRect:t,current:o}=this.state;return r[o].target?(t||this.updateSpotlightRect(),i.createElement(i.Fragment,null,t?i.createElement("svg",{className:`${b}-spotlight`,style:{zIndex:e}},i.createElement("defs",null,i.createElement("mask",{id:`spotlight-${this.userGuideId}`},i.createElement("rect",{width:"100%",height:"100%",fill:"white"}),i.createElement("rect",{className:`${b}-spotlight-rect`,x:t.x,y:t.y,width:t.width,height:t.height,rx:4,fill:"black"}))),n&&i.createElement(i.Fragment,null,i.createElement("rect",{width:"100%",height:"100%",fill:"var(--semi-color-overlay-bg)",mask:`url(#spotlight-${this.userGuideId})`}),i.createElement("rect",{x:0,y:0,width:"100%",height:t.y,fill:"transparent",className:`${b}-spotlight-transparent-rect`}),i.createElement("rect",{x:0,y:t.y,width:t.x,height:t.height,fill:"transparent",className:`${b}-spotlight-transparent-rect`}),i.createElement("rect",{x:t.x+t.width,y:t.y,width:`calc(100% - ${t.x+t.width}px)`,height:t.height,fill:"transparent",className:`${b}-spotlight-transparent-rect`}),i.createElement("rect",{y:t.y+t.height,width:"100%",height:`calc(100% - ${t.y+t.height}px)`,fill:"transparent",className:`${b}-spotlight-transparent-rect`}))):null)):null}render(){const{mode:r,steps:n,visible:e}=this.props;return!e||!n.length?null:i.createElement(i.Fragment,null,r==="popup"?i.createElement(i.Fragment,null,n==null?void 0:n.map((t,o)=>this.renderStep(t,o)),this.renderSpotlight()):null,r==="modal"&&this.renderModal())}}O.propTypes={mask:f.bool,mode:f.oneOf(F.MODE),onChange:f.func,onFinish:f.func,onNext:f.func,onPrev:f.func,onSkip:f.func,position:f.oneOf(F.POSITION_SET),showPrevButton:f.bool,showSkipButton:f.bool,theme:f.oneOf(F.THEME),visible:f.bool,getPopupContainer:f.func,zIndex:f.number};O.defaultProps={mask:!0,mode:"popup",nextButtonProps:{},onChange:C,onFinish:C,onNext:C,onPrev:C,onSkip:C,position:"bottom",prevButtonProps:{},showPrevButton:!0,showSkipButton:!0,steps:[],theme:"default",visible:!1,zIndex:I.DEFAULT_Z_INDEX};function q(h){var r=N.useRef(h);r.current=N.useMemo(function(){return h},[h]);var n=N.useRef();return n.current||(n.current=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.current.apply(this,e)}),n.current}function J(h){function r(n,e){e===void 0&&(e={});var t,o=e.onError,a=o===void 0?function(s){console.error(s)}:o;try{t=h()}catch(s){a(s)}var c=function(s){return e!=null&&e.serializer?e==null?void 0:e.serializer(s):JSON.stringify(s)},d=function(s){return e!=null&&e.deserializer?e==null?void 0:e.deserializer(s):JSON.parse(s)};function p(){try{var s=t==null?void 0:t.getItem(n);if(s)return d(s)}catch(u){a(u)}return B(e==null?void 0:e.defaultValue)?e==null?void 0:e.defaultValue():e==null?void 0:e.defaultValue}var l=j(N.useState(function(){return p()}),2),g=l[0],y=l[1];X(function(){y(p())},[n]);var m=function(s){var u=B(s)?s(g):s;if(y(u),z(u))t==null||t.removeItem(n);else try{t==null||t.setItem(n,c(u))}catch(E){console.error(E)}};return[g,q(m)]}return r}var Z=J(function(){return V?localStorage:void 0});const nt=({id:h})=>{const[r,n]=Z("abcdddef"),e={homePage:[{target:document.querySelector("#step1"),title:"创建应用",description:"首先创建应用菜单",position:"top"},{target:document.querySelector("#step2"),title:"创建模型",description:"进入模型中心，创建实体模型，表单dto模型",position:"top"},{target:document.querySelector("#step3"),title:"创建菜单",description:"创建模型有关的功能菜单",position:"top"}],modelSiderPage:[{target:document.querySelector("#step4"),title:"创建实体模型",description:"创建一个与数据库表有关的实体模型",position:"top"},{target:document.querySelector("#step5"),title:"切换应用",description:"查看其他应用的模型信息",position:"top"}]};return k(M,{children:k(O,{mode:"popup",mask:!0,visible:(r==null?void 0:r[h])===void 0,steps:e[h],onSkip:()=>{n(t=>({...t,[h]:!0}))},onFinish:()=>{n(t=>({...t,[h]:!0}))}},h)})};export{nt as V};
