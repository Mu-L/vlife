import{ae as l,u as Q,r,D as S,a1 as C,l as v,k as b}from"./index-zu87m18r.js";const P=e=>l.post("/form/list",{}),k=e=>l.post("/form/list/entityVo",e||{}),y=e=>l.post("/formDto/list/model",e||{}),J=e=>l.post(`/form/list/subModels/${e}`),R=e=>l.post("/form/save",e),_=e=>l.post("/form/save/formDto",e),G=e=>l.post("/formDto/publish",e),L=e=>l.post("/formDto/entityPublish",e),U=e=>l.delete(`/form/remove/${e}`),$=e=>l.get(`/formDto/detail/${e.id}`),V=(e={})=>{const{allModels:s,setAllModels:i,loadedApps:I,setLoadedApps:j}=Q(),m=r.useRef(s);r.useEffect(()=>{m.current=s},[s]);const M=r.useMemo(()=>{m.current;const{id:t,type:n,sysMenuId:d}=e;if(t)return s==null?void 0:s.find(a=>a.id===t);if(n)return s==null?void 0:s.find(a=>a.type.toUpperCase()===n.toUpperCase());if(d)return s==null?void 0:s.find(a=>a.sysMenuId===d)},[s,e.id,e.sysMenuId,e.type]),f=r.useMemo(()=>{const{types:t}=e;return t&&t.length>0?s==null?void 0:s.filter(d=>t.includes(d.type)):[]},[s,e.types]),o=r.useMemo(()=>{if(e.sysAppId)return s.filter(t=>String(t.sysAppId)===String(e.sysAppId))},[s,e.sysAppId]),x=r.useCallback(t=>{$({id:t}).then(n=>{n.data?i(d=>[...d.filter(u=>u.id!==t),n.data]):i(d=>[...d.filter(u=>u.id!==t)])})},[i]),N=r.useCallback(async({id:t,type:n,sysMenuId:d,dbQuery:a=!1})=>{const u=m.current,D=async c=>{const A=(await y(c)).data||[];return i(E=>[...E.filter(h=>!(h.id===t||h.type===n||h.sysMenuId===d)),...A]),A[0]},g=u.find(c=>c.id===t||c.type===n||c.sysMenuId===d);return g&&!a?g:D({id:t,type:n,sysMenuId:d})},[i]);return r.useEffect(()=>{if((e.dbQuery||!M)&&(e.id||e.type||e.sysMenuId)){const t={id:e==null?void 0:e.id,type:e==null?void 0:e.type,sysMenuId:e==null?void 0:e.sysMenuId};y(t).then(n=>{n.data&&n.data.length>0&&i(d=>[...d.filter(u=>!(u.id===e.id||u.type===e.type||u.sysMenuId===e.sysMenuId)),...n.data||[]])})}},[e.id,e.type,e.sysMenuId,e.dbQuery,JSON.stringify(M)]),r.useEffect(()=>{if((e.dbQuery||!o||o.length===0)&&e.sysAppId){const t={sysAppId:e==null?void 0:e.sysAppId};y(t).then(n=>{n.data&&n.data.length>0&&i(d=>[...d.filter(u=>u.sysAppId!==e.sysAppId),...n.data||[]])})}},[e.sysAppId,e.dbQuery,JSON.stringify(o)]),r.useEffect(()=>{e.types&&e.types.length>0&&(e.dbQuery||!f||f.length===0||f.length!==e.types.length)&&y({conditions:S({fieldName:"type",opt:C.in,value:e.types})}).then(t=>{t.data&&t.data.length>0&&i(n=>[...n.filter(a=>{var u;return!((u=e.types)!=null&&u.includes(a.type))}),...t.data||[]])})},[e.types,e.dbQuery,JSON.stringify(f)]),{model:M,appModels:o,models:f,getModel:N,refeshModel:x}},F=({text:e,className:s,desc:i,size:I="text-sm"})=>v("div",{className:`${s} p-1  w-full flex h-7 items-center justify-between `,children:[v("div",{className:"flex h-full",children:[b("div",{className:" border-2 h-full border-blue-400 mr-2 rounded-md"}),b("div",{className:`font-bold ${I}`,children:e})]}),i&&b("div",{className:" text-xs text-gray-400 h-full flex justify-center items-center",children:i})]});export{F as G,J as a,_ as b,P as c,k as d,L as e,y as l,G as p,U as r,R as s,V as u};
