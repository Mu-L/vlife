import{X as T,u as F,b as R,g as x,r as p,h as v,j as g,a,d as k}from"./index-MyzntyvH.js";import{T as P,b as j,a as E}from"./Tabs-BSy92YAt.js";import{T as G}from"./TableHeader-QCOSFIQ0.js";import{u as M,F as _}from"./formPage-CmcGKePW.js";import{B as $}from"./index-CCDUBNXJ.js";import{G as D}from"./GroupButton-m5Wg7-MC.js";const O=n=>T.post("/sysNews/save",n),Q=n=>T.delete("/sysNews/remove",{data:n}),U=n=>{const{title:w,btns:c,conditionReq:u,listType:A,searchFields:K,filterType:d,defaultActiveKey:f,tabs:o,onFilterFormData:b}=n,{tableData:s,setTableData:m}=F(),{model:t}=M({type:A}),N=R(),[h,C]=x.useState(),[y,S]=x.useState(),B=p.useMemo(()=>{var i,r;let e={orAnd:"and",where:[],conditions:[]};return u&&(e=v(u)),h&&(e={...e,conditions:[...e.conditions,h]}),s.tabActiveKey&&o&&(e={...e,conditions:[...e.conditions,v(((i=o.find(q=>q.key===s.tabActiveKey))==null?void 0:i.conditions)||((r=o[0])==null?void 0:r.conditions))]}),y&&(e={...e,conditions:[...e.conditions,v(y)]}),e},[u,h,o,s.tabActiveKey,y]),l=p.useMemo(()=>(c==null?void 0:c.map(e=>e.entity?e:{...e,entity:t==null?void 0:t.entityType}))||[],[c,t]);return p.useEffect(()=>{if(o&&o.length>0&&!s.tabActiveKey){const e=f||o[0].key;m(i=>({...i,tabActiveKey:e}))}},[s.tabActiveKey,f,o]),g("div",{className:" flex flex-col h-full bg-slate-50 ",children:[t&&a(G,{className:" border-t  w-full bg-white shadow",btns:(l==null?void 0:l.filter(e=>e.actionType==="create"))||[],label:w||t.title,model:t,children:a($,{tooltip:"表单配置",btnType:"icon",allowEmpty:!0,icon:a("i",{className:" icon-build  hover:bg-gray-200 hover:text-blue-500 p-1 rounded-md cursor-pointer"}),actionType:"click",onClick:()=>{N(`/full/formDesignPage/${t.type}`)}})}),o&&o.length>0&&t&&a(P,{activeKey:s.tabActiveKey||f,tabs:o||[],onTabChange:e=>{m(i=>({...i,tabActiveKey:e}))}}),g("div",{className:"flex flex-1 w-full px-2 mt-2 bg-slate-50 space-x-2 ",children:[d&&a(_,{className:"w-60 bg-white p-4 rounded border h-full",type:d,formSetting:!0,fontBold:!1,onChange:e=>{S({...e}),b==null||b({...e})}}),g("div",{className:`flex flex-col ${k({"flex-1 overflow-hidden":d!==void 0,"w-full":d===void 0})}`,children:[t&&a(j,{className:"w-full h-10 rounded-t-xl border bg-white ",leftBtns:a(D,{position:"tableToolbar",activeKey:s.tabActiveKey,btns:l.map(e=>({...e,theme:"borderless",onSubmitFinish:e.onSubmitFinish||(i=>{m(r=>({...r,selected:[],loadDataFlag:r.loadDataFlag+1}))})})),datas:s==null?void 0:s.selected}),tableModel:t,searchFields:K,onSearchChange:C}),t&&a(E,{className:"flex flex-1 border-b border-x bg-white",tableModel:t,req:{conditions:B},btns:l})]})]})]})};export{U as B,Q as r,O as s};
