import{u as B,o as F,c as x,r as p,D as v,l as g,k as i,f as R,ae as T}from"./index-zu87m18r.js";import{T as P,b as E,a as j}from"./Tabs-COcCvxIa.js";import{T as D}from"./TableHeader-DYttKaXK.js";import{F as G}from"./formPage-D0LEgB12.js";import{u as M}from"./GroupLabel-CFJ4I-sR.js";import{V}from"./index-D84rZFL3.js";import{G as _}from"./GroupButton-DUTfCbto.js";const Q=n=>{const{title:w,btns:c,conditionReq:u,listType:A,searchFields:K,filterType:d,defaultActiveKey:f,tabs:o,onFilterFormData:m}=n,{tableData:s,setTableData:b}=B(),{model:t}=M({type:A}),N=F(),[y,C]=x.useState(),[h,S]=x.useState(),k=p.useMemo(()=>{var a,r;let e={orAnd:"and",where:[],conditions:[]};return u&&(e=v(u)),y&&(e={...e,conditions:[...e.conditions,y]}),s.tabActiveKey&&o&&(e={...e,conditions:[...e.conditions,v(((a=o.find(q=>q.key===s.tabActiveKey))==null?void 0:a.conditions)||((r=o[0])==null?void 0:r.conditions))]}),h&&(e={...e,conditions:[...e.conditions,v(h)]}),e},[u,y,o,s.tabActiveKey,h]),l=p.useMemo(()=>(c==null?void 0:c.map(e=>e.entity?e:{...e,entity:t==null?void 0:t.entityType}))||[],[c,t]);return p.useEffect(()=>{if(o&&o.length>0&&!s.tabActiveKey){const e=f||o[0].key;b(a=>({...a,tabActiveKey:e}))}},[s.tabActiveKey,f,o]),g("div",{className:" flex flex-col h-full bg-slate-50 ",children:[t&&i(D,{className:" border-t  w-full bg-white shadow",btns:(l==null?void 0:l.filter(e=>e.actionType==="create"))||[],label:w||t.title,model:t,children:i(V,{tooltip:"表单配置",btnType:"icon",allowEmpty:!0,icon:i("i",{className:" icon-build  hover:bg-gray-200 hover:text-blue-500 p-1 rounded-md cursor-pointer"}),actionType:"click",onClick:()=>{N(`/full/formDesignPage/${t.type}`)}})}),o&&o.length>0&&t&&i(P,{activeKey:s.tabActiveKey||f,tabs:o||[],onTabChange:e=>{b(a=>({...a,tabActiveKey:e}))}}),g("div",{className:"flex flex-1 w-full px-2 mt-2 bg-slate-50 space-x-2 ",children:[d&&i(G,{className:"w-60 bg-white p-4 rounded border h-full",type:d,formSetting:!0,fontBold:!1,onChange:e=>{S({...e}),m==null||m({...e})}}),g("div",{className:`flex flex-col ${R({"flex-1 overflow-hidden":d!==void 0,"w-full":d===void 0})}`,children:[t&&i(E,{className:"w-full h-10 rounded-t-xl border bg-white ",leftBtns:i(_,{position:"tableToolbar",activeKey:s.tabActiveKey,btns:l.map(e=>({...e,theme:"borderless",onSubmitFinish:e.onSubmitFinish||(a=>{b(r=>({...r,selected:[],loadDataFlag:r.loadDataFlag+1}))})})),datas:s==null?void 0:s.selected}),tableModel:t,searchFields:K,onSearchChange:C}),t&&i(j,{className:"flex flex-1 border-b border-x bg-white",tableModel:t,req:{conditions:k},btns:l})]})]})]})},U=n=>T.post("/sysNews/save",n),W=n=>T.delete("/sysNews/remove",{data:n});export{Q as B,W as r,U as s};
